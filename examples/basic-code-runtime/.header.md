# Basic CODE Runtime Example

This example demonstrates the **simplest possible** CODE runtime setup using Python from S3.

**⚠️ ARM64 Requirement**: AgentCore requires ARM64 Python binaries. The module automatically handles this via CodeBuild - no local Docker needed.

## What This Example Does

When you run `terraform apply` from this directory (`examples/basic-code-runtime/`):

- Module zips everything in `./src` directory (the `src/` folder right here)
- Uploads the zip to S3 as `source-input.zip` (without dependencies)
- CodeBuild downloads it, installs ARM64 dependencies using `pip install --platform manylinux2014_aarch64`
- CodeBuild outputs `source.zip` with ARM64 binaries to S3
- Creates an AgentCore Runtime that runs Python code from S3
- Creates a Runtime Endpoint for invoking the agent
- Generates files in `autogen/` directory (debug mode)

## What Gets Created

- 1 S3 bucket (module creates and manages)
- 1 CodeBuild project (ARM64 environment - installs dependencies)
- 1 AgentCore Runtime (Python 3.11)
- 1 Runtime Endpoint
- 1 IAM role with S3 read permissions
- `autogen/.env` - Environment variables with actual AWS resource IDs
- `autogen/test_my_agent.sh` - Test script for invoking the runtime

## Usage

```bash
cd examples/basic-code-runtime
terraform init
terraform apply
```

- **`code_source_path`**: `"./src"` - Path to your Python code relative to where you run terraform (this directory)
- **`code_entry_point`**: `["agent.py"]` - Entry point file within the zip (relative to `./src`)
- **`code_runtime`**: `"PYTHON_3_11"` - Python version
- **`debug`**: `true` - Generates `autogen/.env` and test scripts

## Testing

**Preferred: AWS Console** - Navigate to [Amazon Bedrock > AgentCore > Test](https://console.aws.amazon.com/bedrock-agentcore/playground) and use the Agent sandbox UI.

Or use the generated test script:

```bash
./autogen/test_my_agent.sh "Hello world"
```

Or invoke directly with AWS CLI:

```bash
aws bedrock-agent-runtime invoke-agent \
  --agent-runtime-id <runtime-id> \
  --input-text "Hello" \
  --region us-east-1
```

## Critical Variables

When you modify your code:

```bash
# 1. Edit your Python code
vim src/agent.py

# 2. Apply - triggers rebuild and zero-downtime update
terraform apply
```

**What happens:**
- Module detects source changes (MD5 hash)
- CodeBuild installs ARM64 dependencies and creates new `source.zip`
- Runtime updates in-place to use new S3 version
- **Zero downtime** - no runtime replacement

## Local Testing with .env

The example code shows how to use environment variables:

```python
import os
from dotenv import load_dotenv

# Load .env file (generated by terraform with debug=true)
load_dotenv('autogen/.env')

# Access variables
runtime_id = os.getenv('RUNTIME_ID')
endpoint_arn = os.getenv('ENDPOINT_ARN')
log_level = os.getenv('LOG_LEVEL', 'INFO')
```

Install python-dotenv for local testing:
```bash
pip install python-dotenv
python src/agent.py
```