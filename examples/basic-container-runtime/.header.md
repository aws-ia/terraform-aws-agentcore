# Basic CONTAINER Runtime Example

This example demonstrates the **simplest possible** CONTAINER runtime setup using Docker from ECR.

**⚠️ ARM64 Requirement**: AgentCore requires ARM64 Docker images. The module automatically builds ARM64 images via CodeBuild.

## What This Example Does

When you run `terraform apply` from this directory (`examples/basic-container-runtime/`):

- Module zips everything in `./src` directory (the `src/` folder right here)
- Uploads zip to S3 for CodeBuild
- CodeBuild downloads zip, builds ARM64 Docker image from `./src/Dockerfile`
- Pushes ARM64 image to module-managed ECR repository
- Creates an AgentCore Runtime that runs your container from ECR
- Creates a Runtime Endpoint for invoking the agent
- Generates files in `autogen/` directory (debug mode)

## What Gets Created

- 1 S3 bucket (for CodeBuild artifacts)
- 1 ECR repository (module creates and manages)
- 1 CodeBuild project (ARM64 environment - builds and pushes Docker image)
- 1 AgentCore Runtime (runs your container)
- 1 Runtime Endpoint
- 1 IAM role with ECR pull permissions
- `autogen/.env` - Environment variables with actual AWS resource IDs
- `autogen/test_my_agent.sh` - Test script for invoking the runtime

## Usage

```bash
cd examples/basic-container-runtime
terraform init
terraform apply
```

The module will automatically build ARM64 Docker images during `terraform apply` using CodeBuild.

## Critical Variables

- **`container_source_path`**: `"./src"` - Path to directory containing Dockerfile relative to where you run terraform (this directory)
- **`container_dockerfile_name`**: `"Dockerfile"` (default) - Name of Dockerfile in `./src`
- **`container_image_tag`**: `"latest"` (default) - Docker image tag
- **`debug`**: `true` - Generates `autogen/.env` and test scripts

## Testing

**Preferred: AWS Console** - Navigate to [Amazon Bedrock > AgentCore > Test](https://console.aws.amazon.com/bedrock-agentcore/playground) and use the Agent sandbox UI.

Or use the generated test script:

```bash
./autogen/test_my_agent.sh "Hello world"
```

Or invoke directly with AWS CLI:

```bash
aws bedrock-agent-runtime invoke-agent \
  --agent-runtime-id <runtime-id> \
  --input-text "Hello" \
  --region us-east-1
```

## Code Updates

When you modify your code:

```bash
# 1. Edit your code or Dockerfile
vim src/app.py
vim src/Dockerfile

# 2. Apply - triggers rebuild and zero-downtime update
terraform apply
```

**What happens:**
- Module detects source changes (MD5 hash)
- CodeBuild rebuilds ARM64 image and pushes to ECR
- Runtime updates in-place to use new image
- **Zero downtime** - no runtime replacement
