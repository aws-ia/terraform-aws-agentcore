# Amazon Bedrock AgentCore Terraform Module

Terraform module for creating and managing Amazon Bedrock AgentCore resources. AgentCore is AWS's managed service for running AI agents - you provide the agent code, AWS runs it for you.

## Understanding AgentCore

**Core Components:**

1. **Runtime** - WHERE your agent code runs (Python from S3 or Docker from ECR)
2. **Runtime Endpoint** - HOW you invoke your agent (AWS SDK, not HTTP routes)
3. **Memory** - Persistent context across conversations (short-term + long-term)
4. **Gateway** - Integration with external tools/APIs (Model Context Protocol)
5. **Browser** - Web browsing capability for agents
6. **Code Interpreter** - Secure Python code execution

**How It Works:**

```
1. Deploy: terraform apply (creates runtime + endpoint)
2. Invoke: boto3.client('bedrock-agent-runtime').invoke_agent(...)
3. Agent runs your code and returns response
```

**No API Gateway or Lambda needed** - AgentCore Runtime Endpoint IS the API.

## Features

- Dynamic Runtime Creation (CODE and CONTAINER types)
- Dynamic Runtime Endpoint Creation
- Dynamic Memory Creation with Multiple Strategies
- Dynamic Gateway Creation with MCP Protocol Support
- Dynamic Code Interpreter Creation
- Dynamic Browser Creation
- Automatic ARM64 Build Pipeline for CODE Runtimes via [Terraform Actions](https://www.hashicorp.com/en/blog/day-2-infrastructure-management-with-terraform-actions)
- Automatic ARM64 Container Builds via CodeBuild using [Terraform Actions](https://www.hashicorp.com/en/blog/day-2-infrastructure-management-with-terraform-actions)
- IAM Role Management with Appropriate Permissions
- VPC and Public Network Mode Support
- JWT and IAM Authorization Support

## Important

- **ARM64 Architecture Required**: Amazon Bedrock AgentCore runs exclusively on AWS Graviton (ARM64) processors. When providing your own S3 packages or ECR images, you must ensure ARM64 compatibility. The module handles this automatically for module-managed CODE and CONTAINER runtimes via CodeBuild using [Terraform Actions](https://www.hashicorp.com/en/blog/day-2-infrastructure-management-with-terraform-actions).
- The names of your resources (e.g. runtimes, memories, gateways) are used as map keys to reference them. Ensure you use consistent naming throughout your configuration.
- When using **module-managed CODE runtimes**, the module automatically installs dependencies and builds ARM64-compatible packages via CodeBuild. No local Docker required.
- When using **module-managed CONTAINER runtimes**, the module automatically builds ARM64 Docker images via CodeBuild from your source directory.

## Basic Usage - Create Runtime with Endpoint

```hcl
module "agentcore" {
  source = "aws-ia/agentcore/aws"

  runtimes = {
    my_agent = {
      source_type      = "CODE"
      code_source_path = "./agent"
      code_entry_point = ["agent.py"]
      code_runtime     = "PYTHON_3_11"
      description      = "My AI agent runtime"
      create_endpoint  = true
    }
  }
}
```

## Basic Usage - Create Memory with Strategies

```hcl
module "agentcore" {
  source = "aws-ia/agentcore/aws"

  memories = {
    agent_memory = {
      description           = "Memory for my agent"
      event_expiry_duration = 90
      strategies = [
        {
          semantic_memory_strategy = {
            name        = "semantic_strategy"
            description = "Extract factual knowledge"
            namespaces  = ["/strategies/{memoryStrategyId}/actors/{actorId}"]
          }
        }
      ]
    }
  }
}
```

## Basic Usage - Create Gateway with MCP Protocol

```hcl
module "agentcore" {
  source = "aws-ia/agentcore/aws"

  gateways = {
    mcp_gateway = {
      description   = "Gateway for external tools"
      protocol_type = "MCP"
      protocol_configuration = {
        mcp = {
          instructions       = "Gateway for tool integration"
          search_type        = "DEFAULT"
          supported_versions = ["2025-11-25"]
        }
      }
      authorizer_type = "AWS_IAM"
    }
  }
}
```

## Basic Usage - Create Code Interpreter

```hcl
module "agentcore" {
  source = "aws-ia/agentcore/aws"

  code_interpreters = {
    my_interpreter = {
      description  = "Secure code execution environment"
      network_mode = "SANDBOX"
    }
  }
}
```

## Basic Usage - Create Browser

```hcl
module "agentcore" {
  source = "aws-ia/agentcore/aws"

  browsers = {
    my_browser = {
      description       = "Web browsing for agents"
      network_mode      = "PUBLIC"
      recording_enabled = true
      recording_config = {
        bucket = "my-recordings-bucket"
        prefix = "sessions/"
      }
    }
  }
}
```

## Examples

The module includes several examples demonstrating different use cases:

- [basic-code-runtime](./examples/basic-code-runtime) - CODE runtime with automatic ARM64 build
- [basic-container-runtime](./examples/basic-container-runtime) - CONTAINER runtime with automatic ARM64 Docker build
- [complete](./examples/complete) - All resource types: runtimes, memories, gateways, gateway targets, browsers, code interpreters

See the [examples](./examples) directory for complete working examples.

## Contributing

See the `CONTRIBUTING.md` file for information on how to contribute.
